!function(t){"use strict";var e=t.OE||(t.OE={}),r=e.fileAPI={},n={};n.hin={parseAtomRecord:function(t){var e=t.split(/\s+/);return{el:e[3],x:+e[7],y:+e[8],z:+e[9]}},parseBonds:function(t){var e,r,n,s,i,o=[];for(r=0,e=t.length;e>r;r++)for(n=t[r].split(/\s+/),i=11,s=2*n[10]+11;s>i;i+=2)n[i]-1>r&&o.push({iAtm:r,jAtm:n[i]-1,type:n[i+1]});return o},parse:function(t){var e=t.match(/^atom\s+\d+\s+.+$/gm);return e&&{atoms:e.map(this.parseAtomRecord,this),bonds:this.parseBonds(e)}}},r.loadHIN=function(t,r){var s=new FileReader;s.addEventListener("load",function(){e.structure=n.hin.parse(s.result),e.view.render(),"function"==typeof r&&r()},!1),s.readAsText(t)}}(this);
!function(e){"use strict";var t=e.THREE,r=e.OE||(e.OE={}),o=r.view={},n={el:null,width:600,height:500},s={currentX:0,startX:0,currentRot:0,startRot:0};o.colors={get:function(e){return this._cache.hasOwnProperty(e)||(this._cache[e]=new t.Color(e)),this._cache[e]}},Object.defineProperty(o.colors,"_cache",{value:{}}),o.presets={C:{color:16711680,radius:1},H:{color:16777215,radius:.7}},Object.defineProperty(o.presets,"_def",{configurable:!0,enumerable:!1,writable:!1,value:o.presets.H}),o.atomMaterials={get:function(e){var r=o.presets[e]||o.presets[e="_def"];return this._cache.hasOwnProperty(e)||(this._cache[e]=new t.MeshLambertMaterial({color:r.color})),this._cache[e]}},Object.defineProperty(o.atomMaterials,"_cache",{value:{}}),o.atomGeometries={get:function(e){var r=o.presets[e]||o.presets[e="_def"];return this._cache.hasOwnProperty(e)||(this._cache[e]=new t.SphereGeometry(r.radius)),this._cache[e]}},Object.defineProperty(o.atomGeometries,"_cache",{value:{}}),o.bondMaterials={basic:new t.LineBasicMaterial({vertexColors:t.VertexColors}),extra:new t.LineDashedMaterial({dashSize:.2,gapSize:.1,vertexColors:t.VertexColors})},o.THREE=function(){var e,r;return e={scene:new t.Scene,group:new t.Object3D,camera:new t.PerspectiveCamera(75,n.width/n.height,.1,1e3),renderer:new t.WebGLRenderer},n.el=e.renderer.domElement,e.scene.add(e.group),r=new t.SpotLight(16777215),r.position.set(-40,60,50),e.scene.add(r,new t.AxisHelper(20)),e.camera.position.x=0,e.camera.position.y=0,e.camera.position.z=10,e.camera.lookAt(e.scene.position),e.renderer.setClearColor(0),e.renderer.setSize(n.width,n.height),e.renderer.render(e.scene,e.camera),document.getElementById("oe-view").appendChild(n.el),e}(),o.render=function(){o.resetScene(),o.update()},o.update=function(){var e=o.THREE.group;e.rotation.y+=.05*(s.currentRot-e.rotation.y),o.THREE.renderer.render(o.THREE.scene,o.THREE.camera),o.autoUpdate&&requestAnimationFrame(o.update)},o.clearScene=function(){for(var e,t=o.THREE.group;e=t.children[0];)t.remove(e)},o.appearance="graph",o.resetScene=function(){o.clearScene(),"spheres"===o.appearance?o.addSceneAtoms():o.addSceneBonds()},o.addSceneAtoms=function(){var e,n,s=t.Mesh,a=o.THREE.group,i=o.atomGeometries,c=o.atomMaterials,u=r.structure.atoms,d=u.length;for(e=0;d>e;e++)n=new s(i.get(u[e].el),c.get(u[e].el)),n.position.x=u[e].x,n.position.y=u[e].y,n.position.z=u[e].z,a.add(n)},o.addSceneBonds=function(){var e,n,s,a=t.Line,i=t.Vector3,c=o.THREE.group,u=o.presets,d=o.colors,p=o.bondMaterials,l=r.structure.atoms,h=r.structure.bonds,m=h.length;for(e=0;m>e;e++)s=new t.Geometry,n=l[h[e].iAtm],s.vertices.push(new i(n.x,n.y,n.z)),s.colors.push(d.get((u[n.el]||u._def).color)),n=l[h[e].jAtm],s.vertices.push(new i(n.x,n.y,n.z)),s.colors.push(d.get((u[n.el]||u._def).color)),"x"===h[e].type?(s.computeLineDistances(),c.add(new a(s,p.extra,t.LineStrip))):c.add(new a(s,p.basic))},o.events={},o.events.mouseDown=function(e){s.startX=e.pageX-(n.width>>1),s.startRot=s.currentRot,n.el.addEventListener("mouseup",this.mouseUp,!1),n.el.addEventListener("mouseout",this.mouseOut,!1),n.el.addEventListener("mousemove",this.mouseMove,!1),o.autoUpdate=!0,o.update()}.bind(o.events),o.events.mouseUp=o.events.mouseOut=function(){o.autoUpdate=!1,n.el.removeEventListener("mouseup",this.mouseUp,!1),n.el.removeEventListener("mouseout",this.mouseOut,!1),n.el.removeEventListener("mousemove",this.mouseMove,!1)}.bind(o.events),o.events.mouseMove=function(e){s.currentX=e.pageX-(n.width>>1),s.currentRot=s.startRot+.02*(s.currentX-s.startX)}.bind(o.events),n.el.addEventListener("mousedown",o.events.mouseDown,!1)}(this);
!function(t){"use strict";var s=t.OE||(t.OE={}),r=s.structure={};r.atoms=[],r.bonds=[]}(this);
!function(e){"use strict";var t=e.jQuery,n=e._,a=e.OE,i=a.ui||(a.ui={}),o=t(document);i.$=function(e){return e&&e.jquery?e:t(e)},i.proto={init:function(){var e=this.events||(this.events={});return n.each(e,function(e){var t="string"==typeof e.handler?this[e.handler]:e.handler;i.$(e.owner).on(e.type,e.filter||null,t.bind(this))},this),this}},i.abstractDialog=n.extend(Object.create(i.proto),{init:function(){return this.hasOwnProperty("events")&&(this.events=this.events.concat(i.abstractDialog.events)),i.proto.init.apply(this,arguments)},events:[{type:"click",owner:".oe-apply",handler:"handleApply"},{type:"click",owner:".oe-discard",handler:"handleDiscard"},{type:"keyup",owner:o,handler:"handleGlobalKeyUp"}],handleApply:function(){this.apply(),this.hide()},handleDiscard:function(){this.discard(),this.hide()},handleGlobalKeyUp:function(e){27===e.which&&(this.discard(),this.hide())},apply:t.noop,discard:t.noop,show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")}}),i.potentials=n.extend(Object.create(i.abstractDialog),{$el:t(".oe-potential-form"),tpl:n.template(t("#oe-potentials-tpl").html()),setup:function(){var e,n,o,l=a.structure.atoms,r=[],c=[];for(e=0,o=l.length;o>e;e++)-1===r.indexOf(l[e].el)&&r.push(l[e].el);for(e=0,o=r.length;o>e;e++)for(n=e;o>n;n++)c.push(r[e]+r[n]);t("ul.oe-potentials").html(i.potentials.tpl({pairs:c}))}}).init(),i.appearance=n.extend(Object.create(i.abstractDialog),{$el:t(".oe-appearance-form"),apply:function(){var e=this.$el.find("input[name='appearance']").filter(":checked").data("appearance");e!==a.view.appearance&&(a.view.appearance=e,a.view.render())},discard:function(){this.$el.find("input[data-appearance='"+a.view.appearance+"']").prop("checked",!0)}}).init(),i.menu=n.extend(Object.create(i.proto),{$el:t(".oe-menu"),events:[{type:"click.oe",owner:o,handler:"handleGlobalClick"},{type:"click",owner:".oe-menu",filter:"menuitem[data-action]",handler:"handleAction"},{type:"change",owner:"#oe-file",handler:"handleFile"}],handleGlobalClick:function(e){var n=t(e.target),a=this.$el.find("menu.expanded");n.is(".oe-menu button[menu]")&&(a=a.not(t("#"+n.attr("menu")).toggleClass("expanded"))),a.removeClass("expanded")},handleAction:function(e){var n=t(e.target).data("action")+"Action";"function"==typeof this[n]&&this[n]()},handleFile:function(e){a.fileAPI.loadHIN(e.target.files[0],i.potentials.setup)},loadAction:function(){t("#oe-file").trigger("click")},saveAction:function(){},setupAction:function(){i.potentials.show()},alterAction:function(){i.appearance.show()}}).init()}(this);