!function(t){"use strict";var e={},n={},a=null;e.setStructure=function(t){return a=t,!0},e.updateStructure=function(){t.postMessage({method:"updateStructure",data:a})},e.totalEnergy=function(){return n.totalEnergy()},e.reconnectPairs=function(t){var r,o,u,i,s,c,f=t.pair.match(/[A-Z][^A-Z]*/g),m=t.cutoff,d=a.atoms,l=d.length,p=a.bonds;for(o=0;l>o;o++){if(d[o].el===f[0])s=f[1];else{if(d[o].el!==f[1])continue;s=f[0]}for(u=o+1;l>u;u++)if(d[u].el===s){for(c=n.distance(o,u),i=0,r=p.length;r>i;i++)if(p[i].iAtm===o&&p[i].jAtm===u||p[i].iAtm===u&&p[i].jAtm===o){if("x"!==p[i].type)break;if(c>m){p.splice(i,1);break}}i===r&&m>=c&&p.push({iAtm:o,jAtm:u,type:"x"})}}e.updateStructure()},t.onmessage=function(n){var a=n.data&&n.data.method;"function"==typeof e[a]&&t.postMessage({method:a,data:e[a].call(e,n.data.data)})},n.distance=function(t,e){var n=a.atoms[t],r=a.atoms[e],o=n.x-r.x,u=n.y-r.y,i=n.z-r.z;return Math.sqrt(o*o+u*u+i*i)},n.morse=function(t,e){var n=Math.exp(t.b*(t.R0-e));return t.D0*n*(n-2)},n.totalEnergy=function(){var t,e,r=0,o=a.bonds;for(t=0,e=o.length;e>t;t++)r+=n.morse(o[t].potential,n.distance(o[t].iAtm,o[t].jAtm));return r}}(this);