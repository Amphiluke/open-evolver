!function(e){"use strict";function t(e){var t=e._oid;return i[t]||(t=++o,Object.defineProperty(e,"_oid",{value:t}),i[t]={}),i[t]}var n=e.OE||(e.OE={}),r=n.observer={},i={},o=0;r.on=function(e,n){var r=t(this);r[e]||(r[e]=[]),r[e].push(n)},r.off=function(e,n){var r,i=t(this);i[e]&&(n?(r=i[e].indexOf(n),r>-1&&(i[e].splice(r,1),0===i[e].length&&delete i[e])):(i[e].length=0,delete i[e]))},r.trigger=function(e){var n,r,i,o=t(this);if(o[e])for(n=Array.prototype.slice.call(arguments,1),r=0,i=o[e].length;i>r;r++)o[e][r].apply(null,n)}}(this);
!function(t){"use strict";var e,r=t.OE||(t.OE={}),s=r.utils={};e={H:1.00794,He:4.002602,Li:6.941,Be:9.01218,B:10.811,C:12.011,N:14.0067,O:15.9994,F:18.998403,Ne:20.179,Na:22.98977,Mg:24.305,Al:26.98154,Si:28.0855,P:30.97376,S:32.066,Cl:35.453,Ar:39.948,K:39.0983,Ca:40.078,Sc:44.95591,Ti:47.88,V:50.9415,Cr:51.9961,Mn:54.938,Fe:55.847,Co:58.9332,Ni:58.69,Cu:63.546,Zn:65.39,Ga:69.723,Ge:72.59,As:74.9216,Se:78.96,Br:79.904,Kr:83.8,Rb:85.4678,Sr:87.62,Y:88.9059,Zr:91.224,Nb:92.9064,Mo:95.94,Tc:97.9072,Ru:101.07,Rh:102.9055,Pd:106.42,Ag:107.8682,Cd:112.41,In:114.82,Sn:118.71,Sb:121.75,Te:127.6,I:126.9045,Xe:131.29,Cs:132.9054,Ba:137.33,La:138.9055,Ce:140.12,Pr:140.9077,Nd:144.24,Pm:144.9128,Sm:150.36,Eu:151.96,Gd:157.25,Tb:158.9254,Dy:162.5,Ho:164.9304,Er:167.26,Tm:168.9342,Yb:173.04,Lu:174.967,Hf:178.49,Ta:180.9479,W:183.85,Re:186.207,Os:190.2,Ir:192.22,Pt:195.08,Au:196.9665,Hg:200.59,Tl:204.383,Pb:207.2,Bi:208.9804,Po:208.9824,At:209.9871,Rn:222.0176,Fr:223.0197,Ra:226.0254,Ac:227.0278,Th:232.0381,Pa:231.0359,U:238.0289,Np:237.0482,Pu:244.0642,Am:243.0614,Cm:247.0703,Bk:247.0703,Cf:251.0796,Es:252.0828,Fm:257.0951,Md:258.0986,No:259.1009,Lr:260.1054,Rf:261,Db:262,Sg:263,Bh:262,Hs:265,Mt:266},s.getAtomicMass=function(t){return e[t]},s.getReducedMass=function(t){var e,r,a=t.match(/[A-Z][^A-Z]*/g);if(!a)throw new Error("Cannot extract element labels from string "+t);return e=s.getAtomicMass(a[0]),r=s.getAtomicMass(a[1]),e*r/(e+r)}}(this);
!function(e){"use strict";var a,t,r=e._,n=e.OE,o=n.app=Object.create(n.observer),i=o.actions={},c={},l=0;Object.defineProperties(o,{STARTED:{value:Object.freeze({load:!0,save:!1,saveSummary:!1,alterGraph:!1,setup:!1,transform:!1,calcEnergy:!1,calcGrad:!1,evolve:!1,alterView:!1})},STRUCTURE_LOADED:{value:Object.freeze({load:!0,save:!0,saveSummary:!1,alterGraph:!0,setup:!0,transform:!0,calcEnergy:!1,calcGrad:!1,evolve:!1,alterView:!0})},PARAMS_SET:{value:Object.freeze({load:!0,save:!0,saveSummary:!0,alterGraph:!0,setup:!0,transform:!0,calcEnergy:!0,calcGrad:!0,evolve:!0,alterView:!0})},BUSY:{value:Object.freeze({load:!1,save:!1,saveSummary:!1,alterGraph:!1,setup:!1,transform:!1,calcEnergy:!1,calcGrad:!1,evolve:!1,alterView:!1})},IDLE:{value:Object.seal({load:void 0,save:void 0,saveSummary:void 0,alterGraph:void 0,setup:void 0,transform:void 0,calcEnergy:void 0,calcGrad:void 0,evolve:void 0,alterView:void 0})}}),function(e){o._isStatePredefined=function(a){if(a===o.IDLE)return!1;for(var t=e.length-1;t>=0;t--)if(o[e[t]]===a)return!0;return!1}}(Object.getOwnPropertyNames(o)),Object.defineProperty(o,"state",{configurable:!1,enumerable:!0,get:function(){return o._isStatePredefined(a)?a:r.clone(a)},set:function(e){var t;if(e===a)return void(a===o.BUSY&&l++);if(e===o.BUSY){l++;for(t in o.IDLE)o.IDLE.hasOwnProperty(t)&&(o.IDLE[t]=i[t].enabled)}else if(e===o.IDLE){if(a!==o.BUSY||--l>0)return}else if(a===o.BUSY)return;a=o._isStatePredefined(e)?e:r.clone(e),o.trigger("stateChange")}}),o.addAction=function(e,a){i[e]=Object.create(t,{name:{value:e}}),c[e]={exec:a}},t=Object.create(Object.prototype,{enabled:{enumerable:!0,configurable:!0,get:function(){return o.state[this.name]},set:function(e){var a=o.state;e=!!e,a[this.name]!==e&&(a[this.name]=e,o.state=a)}},exec:{configurable:!0,value:function(){var e=c[this.name];e.enabled&&e.exec.apply(this,arguments)}}}),o.addAction("load",function(e){e&&n.fileAPI.loadHIN(e,function(){n.ui.report.hide()})}),o.addAction("save",function(){n.ui.save.show()}),o.addAction("saveSummary",function(){n.worker.invoke("collectStats")}),o.addAction("alterGraph",function(){n.ui.graph.show()}),o.addAction("setup",function(){n.ui.potentials.show()}),o.addAction("transform",function(){n.ui.transform.show()}),o.addAction("calcEnergy",function(){n.worker.invoke("totalEnergy")}),o.addAction("calcGrad",function(){n.worker.invoke("gradient")}),o.addAction("evolve",function(){n.ui.evolve.show()}),o.addAction("alterView",function(){n.ui.appearance.show()}),o.on("stateChange",function(){var e,a=o.state;for(e in a)a.hasOwnProperty(e)&&i.hasOwnProperty(e)&&(c[e].enabled=a[e])}),o.state=o.STARTED}(this);
!function(t){"use strict";var e=t.OE,a=e.app,r=e.worker=Object.create(e.observer),n=new t.Worker("src/js/calc.js"),s=null;r.invoke=function(t,e){s=t,a.state=a.BUSY,n.postMessage({method:t,data:e})},n.addEventListener("error",function(t){throw t}),n.addEventListener("message",function(t){var e=t.data&&t.data.method;e&&(e===s&&(a.state=a.IDLE,s=null),r.trigger(e,t.data.data))})}(this);
!function(t){"use strict";var e=t._,r=t.OE,s=r.app,u=r.structureUtils=Object.create(r.observer);r.structure={atoms:[],bonds:[],potentials:{}},u.atomList=[],u.pairList=[],u.overwrite=function(t,e,n){var o,i,a,c,l,f;if(r.structure=t,e!==!1){for(i=u.atomList,a=u.pairList,i.length=a.length=0,o=r.structure.atoms,c=0,f=o.length;f>c;c++)-1===i.indexOf(o[c].el)&&i.push(o[c].el);for(c=0,f=i.length;f>c;c++)for(l=c;f>l;l++)a.push(i[c]+i[l]);u.pairList=a.concat(a.map(function(t){return"x-"+t}))}u.trigger("updateStructure",e!==!1),n!==!0&&(s.state=s.STRUCTURE_LOADED,u.syncWorker())},u.setPotentials=function(t){var n,o,i,a=r.structure.atoms,c=r.structure.bonds;for(e.each(t,function(t,e){t.b=t.w0*Math.sqrt(r.utils.getReducedMass(e)/t.D0)*.0013559906}),r.structure.potentials=t,o=0,i=c.length;i>o;o++)n="x"===c[o].type?"x-":"",c[o].potential=t[n+a[c[o].iAtm].el+a[c[o].jAtm].el]||t[n+a[c[o].jAtm].el+a[c[o].iAtm].el];s.state=s.PARAMS_SET,u.syncWorker()},u.getCenterOfMass=function(){var t,e,s,u=r.utils,n=r.structure.atoms,o={x:0,y:0,z:0},i=0;for(e=0,s=n.length;s>e;e++)t=u.getAtomicMass(n[e].el),i+=t,o.x+=t*n[e].x,o.y+=t*n[e].y,o.z+=t*n[e].z;return o.x/=i,o.y/=i,o.z/=i,o},u.translate=function(t,e,s){var n,o,i=r.structure.atoms,a=u.getCenterOfMass(),c=t-a.x,l=e-a.y,f=s-a.z;for(n=0,o=i.length;o>n;n++)i[n].x+=c,i[n].y+=l,i[n].z+=f;u.overwrite(r.structure,!1,!1),r.view.render()},u.rotate=function(t,e){var s,n,o,i,a=r.structure.atoms,c="x"===e?"y":"x",l="z"===e?"y":"z",f=Math.sin(t),v=Math.cos(t);for(o=0,i=a.length;i>o;o++)s=a[o][c],n=a[o][l],a[o][c]=s*v+n*f,a[o][l]=n*v-s*f;u.overwrite(r.structure,!1,!1),r.view.render()},u.syncWorker=function(){r.worker.invoke("setStructure",r.structure)},r.worker.on("setStructure",function(t){u.overwrite(t,!1,!0)}),r.worker.on("updateStructure",function(t){u.overwrite(t,!1,!0),r.view.render()})}(this);
!function(e){"use strict";var t,n=e.OE||(e.OE={}),r=n.fileAPI={},o={};o.hin={parseAtomRecord:function(e){var t=e.split(/\s+/);return{el:t[3],x:+t[7],y:+t[8],z:+t[9]}},parseBonds:function(e){var t,n,r,o,i,s=[];for(n=0,t=e.length;t>n;n++)for(r=e[n].split(/\s+/),i=11,o=2*r[10]+11;o>i;i+=2)r[i]-1>n&&s.push({iAtm:n,jAtm:r[i]-1,type:r[i+1]});return s},parse:function(e){var t=e.match(/^atom\s+\d+\s+.+$/gm);return t&&{atoms:t.map(this.parseAtomRecord,this),bonds:this.parseBonds(t)}}},r.loadHIN=function(e,t){this.readFile(e,function(e){n.structureUtils.overwrite(o.hin.parse(e)),n.view.render(),"function"==typeof t&&t(e)})},r.makeFile=function(e,t){return e=e.toUpperCase(),"function"==typeof this["make"+e]?this["make"+e](t):!1},r.makeHIN=function(e){var t,r,o,i,s,a,u=";The structure was saved in OpenEvolver\nforcefield mm+\n",l=n.structure.atoms,d=l.length;if("empty"===e)for(a=0;d>a;a++)t=l[a],u+="mol "+(a+1)+"\natom 1 - "+t.el+" ** - 0 "+t.x.toFixed(4)+" "+t.y.toFixed(4)+" "+t.z.toFixed(4)+" 0\nendmol "+(a+1)+"\n";else{for(r=n.structure.bonds,s=new Array(d),a=0,o=r.length;o>a;a++)i=r[a],("basic"!==e||"x"!==i.type)&&((s[i.iAtm]||(s[i.iAtm]=[])).push(i.jAtm+1+" "+i.type),(s[i.jAtm]||(s[i.jAtm]=[])).push(i.iAtm+1+" "+i.type));for(u+="mol 1\n",a=0;d>a;a++)t=l[a],u+="atom "+(a+1)+" - "+t.el+" ** - 0 "+t.x.toFixed(4)+" "+t.y.toFixed(4)+" "+t.z.toFixed(4)+" "+(s[a]?s[a].length+" "+s[a].join(" "):"0")+"\n";u+="endmol 1"}return u},r.readFile=function(t,n){var r,o;"string"==typeof t?(r=new XMLHttpRequest,r.open("GET",t,!0),r.addEventListener("load",function(){200===r.status&&n(r.responseText)},!1),r.send(null)):(o=new e.FileReader,o.addEventListener("load",function(){n(o.result)},!1),o.readAsText(t))},r.getBlobURL=function(n,r){var o;return o=n instanceof e.Blob?n:new e.Blob([n],{type:r||"text/plain"}),t&&e.URL.revokeObjectURL(t),t=e.URL.createObjectURL(o)}}(this);
!function(e){"use strict";var t=e.THREE,r=e.OE||(e.OE={}),o=r.view={},n={el:null,width:600,height:500},s={currentX:0,startX:0,currentRot:0,startRot:0};o.colors={get:function(e){return this._cache.hasOwnProperty(e)||(this._cache[e]=new t.Color(e)),this._cache[e]}},Object.defineProperty(o.colors,"_cache",{value:{}}),o.presets={C:{color:16711680,radius:1},H:{color:16777215,radius:.7}},Object.defineProperty(o.presets,"_def",{configurable:!0,enumerable:!1,writable:!1,value:o.presets.H}),o.atomMaterials={get:function(e){var r=o.presets[e]||o.presets[e="_def"];return this._cache.hasOwnProperty(e)||(this._cache[e]=new t.MeshLambertMaterial({color:r.color})),this._cache[e]}},Object.defineProperty(o.atomMaterials,"_cache",{value:{}}),o.atomGeometries={get:function(e){var r=o.presets[e]||o.presets[e="_def"];return this._cache.hasOwnProperty(e)||(this._cache[e]=new t.SphereGeometry(r.radius)),this._cache[e]}},Object.defineProperty(o.atomGeometries,"_cache",{value:{}}),o.bondMaterials={basic:new t.LineBasicMaterial({vertexColors:t.VertexColors}),extra:new t.LineDashedMaterial({dashSize:.2,gapSize:.1,vertexColors:t.VertexColors})},o.THREE=function(){var e,r;return e={scene:new t.Scene,group:new t.Object3D,camera:new t.PerspectiveCamera(75,n.width/n.height,.1,1e3),renderer:new t.WebGLRenderer},n.el=e.renderer.domElement,e.scene.add(e.group),r=new t.SpotLight(16777215),r.position.set(-40,60,50),e.scene.add(r,new t.AxisHelper(20)),e.camera.position.x=0,e.camera.position.y=0,e.camera.position.z=20,e.camera.lookAt(e.scene.position),e.renderer.setClearColor(0),e.renderer.setSize(n.width,n.height),e.renderer.render(e.scene,e.camera),document.getElementById("oe-view").appendChild(n.el),e}(),o.render=function(){o.resetScene(),o.update()},o.update=function(){var e=o.THREE.group;e.rotation.y+=.05*(s.currentRot-e.rotation.y),o.THREE.renderer.render(o.THREE.scene,o.THREE.camera),o.autoUpdate&&requestAnimationFrame(o.update)},o.clearScene=function(){for(var e,t=o.THREE.group;e=t.children[0];)t.remove(e)},o.appearance="graph",o.resetScene=function(){o.clearScene(),"spheres"===o.appearance?o.addSceneAtoms():o.addSceneBonds()},o.addSceneAtoms=function(){var e,n,s=t.Mesh,a=o.THREE.group,i=o.atomGeometries,c=o.atomMaterials,u=r.structure.atoms,d=u.length;for(e=0;d>e;e++)n=new s(i.get(u[e].el),c.get(u[e].el)),n.position.x=u[e].x,n.position.y=u[e].y,n.position.z=u[e].z,a.add(n)},o.addSceneBonds=function(){var e,n,s,a=t.Line,i=t.Vector3,c=o.THREE.group,u=o.presets,d=o.colors,p=o.bondMaterials,l=r.structure.atoms,h=r.structure.bonds,m=h.length;for(e=0;m>e;e++)s=new t.Geometry,n=l[h[e].iAtm],s.vertices.push(new i(n.x,n.y,n.z)),s.colors.push(d.get((u[n.el]||u._def).color)),n=l[h[e].jAtm],s.vertices.push(new i(n.x,n.y,n.z)),s.colors.push(d.get((u[n.el]||u._def).color)),"x"===h[e].type?(s.computeLineDistances(),c.add(new a(s,p.extra,t.LineStrip))):c.add(new a(s,p.basic))},o.events={},o.events.mouseDown=function(e){s.startX=e.pageX-(n.width>>1),s.startRot=s.currentRot,n.el.addEventListener("mouseup",this.mouseUp,!1),n.el.addEventListener("mouseout",this.mouseOut,!1),n.el.addEventListener("mousemove",this.mouseMove,!1),o.autoUpdate=!0,o.update()}.bind(o.events),o.events.mouseUp=o.events.mouseOut=function(){o.autoUpdate=!1,n.el.removeEventListener("mouseup",this.mouseUp,!1),n.el.removeEventListener("mouseout",this.mouseOut,!1),n.el.removeEventListener("mousemove",this.mouseMove,!1)}.bind(o.events),o.events.mouseMove=function(e){s.currentX=e.pageX-(n.width>>1),s.currentRot=s.startRot+.02*(s.currentX-s.startX)}.bind(o.events),n.el.addEventListener("mousedown",o.events.mouseDown,!1)}(this);
!function(e){"use strict";var t=e.jQuery,a=e._,n=e.OE,i=n.app,r=i.actions,o=n.ui||(n.ui={}),l=t(document),s=t(document.body);o.$=function(e){return e&&e.jquery?e:t(e)},o.loadTpls=function(){return t.getJSON("src/tpl/tpl.json").done(function(e){o.tpls={},a.each(e,function(e,t){o.tpls[t]=a.template(e,{variable:"data"})})})},o.proto={init:function(){var e=this.events||(this.events={});return a.each(e,function(e){var t="string"==typeof e.handler?this[e.handler]:e.handler;o.$(e.owner||this.$el).on(e.type,e.filter||null,t.bind(this))},this),this}},o.abstractDialog=a.extend(Object.create(o.proto),{init:function(){return this.hasOwnProperty("events")&&(this.events=this.events.concat(o.abstractDialog.events)),o.proto.init.apply(this,arguments)},events:[{type:"click",filter:".oe-apply",handler:"handleApply"},{type:"click",filter:".oe-discard",handler:"handleDiscard"},{type:"keyup",owner:l,handler:"handleGlobalKeyUp"}],handleApply:function(){this.apply(),this.hide()},handleDiscard:function(){this.discard(),this.hide()},handleGlobalKeyUp:function(e){27===e.which&&(this.discard(),this.hide())},apply:t.noop,discard:t.noop,show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")}}),o.save=a.extend(Object.create(o.abstractDialog),{$el:t(".oe-save-form"),events:[{type:"change",owner:"#oe-file-type",handler:"handleTypeChange"},{type:"mousedown",filter:".oe-apply",handler:"handleSave"}],handleTypeChange:function(e){this.$el.find(".type-description").addClass("hidden").filter("[data-type='"+e.target.value+"']").removeClass("hidden")},handleSave:function(e){var a=t("#oe-file-type").find("option:selected"),i=a.closest("optgroup").data("type"),r=a.data("graph"),o=n.fileAPI.makeFile(i,r);o&&(e.target.setAttribute("download","untitled."+i),e.target.href=n.fileAPI.getBlobURL(o))}}).init(),o.saveSummary=a.extend(Object.create(o.abstractDialog),{$el:t(".oe-save-summary-form"),data:null,events:[{type:"mousedown",filter:"a[download]",handler:"handleSave"},{type:"click",filter:"a[download]",handler:"hide"}],handleSave:function(t){var a,i;if(this.data){switch(a=t.target.getAttribute("data-type")){case"text/html":i=o.tpls.summary(this.data);break;case"application/json":i=e.JSON.stringify(this.data,null,2);break;default:i="TBD"}t.target.href=n.fileAPI.getBlobURL(i,a)}}}).init(),o.graph=a.extend(Object.create(o.abstractDialog),{$el:t(".oe-graph-form"),init:function(){return n.structureUtils.on("updateStructure",function(e){e&&o.graph.resetHTML.call(o.graph)}),o.abstractDialog.init.apply(this,arguments)},events:[{type:"click",filter:".oe-cutoffs .oe-cutoff",handler:"handlePairSelect"},{type:"change",filter:".oe-cutoff-slider",handler:"handleSliderChange"},{type:"input",owner:"#oe-cutoff-exact",handler:"handleCutoffInput"},{type:"change",owner:"#oe-cutoff-exact",handler:"handleCutoffChange"}],handlePairSelect:function(e){var a=t(e.target),n=a.text().trim();t(e.delegateTarget).find(".oe-cutoff").not(a).removeClass("active"),a.addClass("active"),t("#oe-cutoff-exact").val(n).get(0).select(),t(".oe-cutoff-slider").val(this.cutoff2Slider(+n).toFixed(2))},handleSliderChange:function(e){var a=this.slider2Cutoff(+e.target.value);t("#oe-cutoff-exact").val(a.toFixed(4)).trigger("input"),this.updateGraph(t(".oe-cutoff.active").data("pair"),a)},handleCutoffInput:function(e){t(".oe-cutoff.active").text(e.target.value)},handleCutoffChange:function(e){e.target.checkValidity()&&(t(".oe-cutoff-slider").val(this.cutoff2Slider(+e.target.value).toFixed(2)),this.updateGraph(t(".oe-cutoff.active").data("pair"),+e.target.value))},cutoff2Slider:function(e){var a=t(".oe-cutoff-slider")[0],n=+t("#oe-cutoff-min").val(),i=+t("#oe-cutoff-max").val(),r=+a.min,o=+a.max;return r+(e-n)*(o-r)/(i-n)},slider2Cutoff:function(e){var a=t(".oe-cutoff-slider")[0],n=+t("#oe-cutoff-min").val(),i=+t("#oe-cutoff-max").val(),r=+a.min,o=+a.max;return n+(e-r)*(i-n)/(o-r)},resetHTML:function(){this.$el.find(".oe-cutoffs").html(o.tpls.cutoffs({pairs:n.structureUtils.pairList.slice(0,n.structureUtils.pairList.length/2)})).find(".oe-cutoff").eq(0).addClass("active")},updateGraph:function(e,t){n.worker.invoke("reconnectPairs",{pair:e,cutoff:t})}}).init(),o.potentials=a.extend(Object.create(o.abstractDialog),{$el:t(".oe-potential-form"),init:function(){return n.structureUtils.on("updateStructure",function(e){e&&o.potentials.resetHTML.call(o.potentials)}),o.abstractDialog.init.apply(this,arguments)},events:[{type:"change",filter:".load-potentials",handler:"handleLoad"},{type:"mousedown",filter:".save-potentials",handler:"handleSave"}],handleLoad:function(e){n.fileAPI.readFile(e.target.files[0],function(e){var t=e.split(/\r?\n/);a.each(t,function(e){var t=e.split("	");o.potentials.$el.find("li[data-pair='"+t[0]+"'] input").val(function(e){return t[e+1]||""})})})},handleSave:function(e){var a=this.$el.find("li[data-pair]").map(function(){var e=t(this);return e.data("pair")+"	"+e.find("input").map(function(){return this.value}).get().join("	")}).get().join("\r\n");e.target.href=n.fileAPI.getBlobURL(a)},handleApply:function(){return this.$el[0].checkValidity()?o.abstractDialog.handleApply.apply(this,arguments):void window.alert("Please, fix invalid input first")},resetHTML:function(){this.$el.find("ul.oe-potentials").html(o.tpls.potentials({pairs:n.structureUtils.pairList}))},apply:function(){var e={};this.$el.find("li[data-pair]").each(function(a,n){var i={};n=t(n),n.find("input[data-param]").each(function(e,a){return a.value?(i[t(a).data("param")]=+a.value,void(a.defaultValue=a.value)):i=!1}),i&&(e[n.data("pair")]=i)}),n.structureUtils.setPotentials(e)},discard:function(){this.$el[0].reset()},show:function(){var e,a,i,r,l=n.structure.atoms,s=n.structure.bonds,d=s.length,c=[];for(r=0;d>r;r++)e="x"===s[r].type?"x-":"",a=l[s[r].iAtm].el,i=l[s[r].jAtm].el,-1===c.indexOf(e+a+i)&&(c.push(e+a+i),a!==i&&c.push(e+i+a));return this.$el.find("li[data-pair]").each(function(e,a){a=t(a),a.toggleClass("missed",-1===c.indexOf(a.data("pair")))}),o.abstractDialog.show.apply(this,arguments)}}).init(),o.transform=a.extend(Object.create(o.abstractDialog),{$el:t(".oe-transform-form"),events:[{type:"click",owner:"#oe-translate-apply",handler:"handleTranslate"},{type:"click",filter:".oe-rotate [data-axis]",handler:"handleRotate"}],handleTranslate:function(){var e=this.$el.find(".oe-translate"),t=+e.find("[data-axis='x']").val(),a=+e.find("[data-axis='y']").val(),i=+e.find("[data-axis='z']").val();n.structureUtils.translate(t,a,i)},handleRotate:function(e){var a=t("#oe-rotate-angle").val()*Math.PI/180,i=e.target.getAttribute("data-axis");n.structureUtils.rotate(a,i)},show:function(){var e=n.structureUtils.getCenterOfMass();return this.$el.find(".oe-translate input[data-axis]").val(function(){return e[t(this).data("axis")].toFixed(5)}),o.abstractDialog.show.apply(this,arguments)}}).init(),o.report=a.extend(Object.create(o.abstractDialog),{$el:t(".oe-report"),handleGlobalKeyUp:t.noop,print:function(e){this.updateProgress(100),t("#oe-report-data").html(o.tpls.report({energy:e.energy,grad:e.norm}))},updateProgress:function(e){t("#oe-report-progress").attr("value",e)}}).init(),o.evolve=a.extend(Object.create(o.abstractDialog),{$el:t(".oe-evolve-form"),init:function(){return n.worker.on("evolve",this.handleEvolveStop.bind(this)),n.worker.on("evolve.progress",o.report.updateProgress.bind(o.report)),o.abstractDialog.init.apply(this,arguments)},handleEvolveStop:function(e){o.report.print(e)},handleApply:function(){return this.$el[0].checkValidity()?o.abstractDialog.handleApply.apply(this,arguments):void window.alert("Please, fix invalid input first")},apply:function(){this.$el.find("input[type='text']").each(function(e,t){t.defaultValue=t.value}),this.$el.find("input[type='checkbox']").each(function(e,t){t.defaultChecked=t.checked}),n.worker.invoke("evolve",{stepCount:+t("#oe-step-count").val(),temperature:+t("#oe-temperature").val(),stoch:t("#oe-stoch").prop("checked")}),o.report.show()},discard:function(){this.$el[0].reset()}}).init(),o.appearance=a.extend(Object.create(o.abstractDialog),{$el:t(".oe-appearance-form"),apply:function(){var e=this.$el.find("input[name='appearance']").filter(":checked").data("appearance");e!==n.view.appearance&&(n.view.appearance=e,n.view.render())},discard:function(){this.$el.find("input[data-appearance='"+n.view.appearance+"']").prop("checked",!0)}}).init(),o.info=a.extend(Object.create(o.abstractDialog),{$el:t(".oe-info-dialog"),applyTpl:function(e,t){this.$el.find(".oe-info-dialog-text").html(o.tpls[e](t))}}).init(),o.menu=a.extend(Object.create(o.proto),{$el:t(".oe-menu"),init:function(){return this.setItemStates(),n.app.on("stateChange",this.setItemStates.bind(this)),o.proto.init.apply(this,arguments)},events:[{type:"click.oe",owner:l,handler:"handleGlobalClick"},{type:"mouseenter",owner:".oe-menu",filter:"button[menu]",handler:"handleHover"},{type:"click",owner:".oe-menu",filter:"menuitem[data-action]",handler:"handleAction"},{type:"change",owner:"#oe-file",handler:"handleFile"}],handleGlobalClick:function(e){var a=t(e.target),n=this.$el.find("menu.expanded");a.is(".oe-menu button[menu]")&&(n=n.not(t("#"+a.attr("menu")).toggleClass("expanded"))),n.removeClass("expanded")},handleHover:function(e){var a,n=this.$el.find("menu.expanded");n.length&&(a=t(e.target).siblings("menu"),n.is(a)||(n.removeClass("expanded"),a.addClass("expanded")))},handleAction:function(e){var a=t(e.target).data("action");r[a]&&r[a].exec&&("load"===a?t("#oe-file").trigger("click"):r[a].exec())},handleFile:function(e){r.load.exec(e.target.files[0])},setItemStates:function(e){var a=t("menuitem[data-action]");e&&(a=a.filter("[data-action='"+e+"']")),a.each(function(e,t){var a=r[t.getAttribute("data-action")].enabled,n=t.hasAttribute("disabled");a&&n?t.removeAttribute("disabled"):a||n||t.setAttribute("disabled","disabled")})}}).init(),n.worker.on("totalEnergy",function(e){o.info.applyTpl("energy",{energy:e,bonds:n.structure.bonds.length}),o.info.show()}),n.worker.on("gradient",function(e){o.info.applyTpl("gradient",{grad:e}),o.info.show()}),n.worker.on("collectStats",function(e){e.name=t("#oe-file")[0].files[0].name,o.saveSummary.data=e,o.saveSummary.show()}),i.on("stateChange",function(){s.toggleClass("app-busy",i.state===i.BUSY)}),i.state=i.BUSY,o.loadTpls().done(function(){i.state=i.IDLE})}(this);
!function(e){"use strict";function t(e){var t=c.contentDocument;return t.open(),t.write(e),t.close(),t}function n(e){var t=d.contentDocument;return t.getElementsByTagName("img")[0].src=e,t}var a,r,o,i,c,d;"download"in document.createElement("a")||(a={},r=e.URL,o=r.createObjectURL,i=r.revokeObjectURL,r.createObjectURL=function(t){var n,r=o.apply(this,arguments),i=t.type;return 0===i.indexOf("text/")?(n=new e.FileReader,n.addEventListener("load",function(e){a[r]=e.target.result}),n.readAsText(t)):0===i.indexOf("image/")&&(a[r]="\x00"),r},r.revokeObjectURL=function(e){return a.hasOwnProperty(e)&&delete a[e],i.apply(this,arguments)},c=document.createElement("iframe"),c.src="about:blank",d=document.createElement("iframe"),d.src="src/img/dot.gif",c.style.cssText=d.style.cssText="position: absolute; top: -10000px; left: -10000px;",document.body.appendChild(c),document.body.appendChild(d),document.body.addEventListener("click",function(e){var r,o,i=e.target;if("a"===i.nodeName.toLowerCase()&&i.hasAttribute("download")){if(r=i.getAttribute("href"),0===r.indexOf("blob:")&&a.hasOwnProperty(r))o="\x00"===a[r]?n(r):t(a[r]);else if(0===r.indexOf("data:text/"))o=t(atob(r.replace(/^data:text\/\w+;base64,/,"")));else{if(0!==r.indexOf("data:image/"))return;o=n(r)}setTimeout(function(){o.execCommand("SaveAs",!0,i.getAttribute("download"))},0),e.preventDefault()}},!1))}(this);